!function(){"use strict";var t,e=0,n=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(n){var i=Math.max(0,16-((t=(new Date).getTime())-e)),r=setTimeout(function(){n(t+i)},i);return e=t+i,r},i=window.cancelAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||function(t){clearTimeout(t)},r=function(t){return this.init(t)};r.prototype={init:function(){this._objects=[],this._triggers={};var t=this;return"ontouchstart"in window?(this._start="touchstart",this._end="touchend"):(this._start="mousedown",this._end="mouseup"),window.addEventListener("keydown",function(e){for(var n=t._triggers[e.keyCode]||[],i=0,r=n.length;r>i;i++){var s=n[i],a=s[0],o=s[1],u=o.ms;(o=a._actions[o.start]).status||t._raf(a,o,u)}}),window.addEventListener("keyup",function(e){for(var n=t._triggers[e.keyCode]||[],i=0,r=n.length;r>i;i++){var s=n[i],a=s[0],o=s[1],u=o.ms;if(o.end){var c=a._actions[o.start];(o=a._actions[o.end]).status||t._raf(a,t._keyupWrapper(c,o),u)}}}),this},_keyupWrapper:function(t,e){return{cb:function(n){var r=e.cb(n);r||(i(t.status),delete t.status)}}},_raf:function(t,e,i){var r,s=this,a=function(t){r||(r=t);var o=!0,u=t-r;u>=i(s)&&(r=0,o=e.cb(s)),o?e.status=n(a):delete e.status};e.status=n(a)},createObject:function(){return this._Object.apply(this,[this].concat(arguments))}};var s=r.prototype._Object=function(t){return this instanceof s?((this._game=t)._objects.push(this),this.init()):new this._Object(t)};s.prototype={init:function(){return this._actions={},this},action:function(t,e){var n=this;return this._actions[t]={cb:function(){return e.apply(n,arguments)}},this},trigger:function(t){if("start"in t&&!(t.start in this._actions)||"end"in t&&!(t.end in this._actions))return this;t.ms=this._ms(t.ms);var e=t.trigger,n=this._actions[t.start],i=this._actions[t.end];if("number"!=typeof t.trigger||!("trigger"in t)){var r=this._game,s=t.ms,a=this._startEvent(r,n,s);return(n.elems=n.elems||[]).push([e,r._start,a]),e.addEventListener(r._start,a),i&&(a=this._endEvent(r,n,i,s),(i.elems=i.elems||[]).push([e,r._end,a]),e.addEventListener(r._end,a)),this}return(this._game._triggers[t.trigger]=this._game._triggers[t.trigger]||[]).push([this,t]),this},destroy:function(){var t,e,n,i,r,s,a=this._game,o=a._triggers,u=this._actions;for(t=0,n=a._objects,e=n.length;e>t;t++)if(n[t]===this){n.splice(t,1);break}for(s in o)if(o.hasOwnProperty(s))for(t=0,i=o[s],e=i.length;e>t;t++)i[t][0]===this&&i.splice(t,1);for(s in u)if(u.hasOwnProperty(s))for(t=0,r=u[s].elems,e=r&&r.length;e>t;t++){var c=r[t];c[0].removeEventListener(c[1],c[2]),delete u[s]}delete this._actions},_startEvent:function(t,e,n){var i=this;return function(r){e.status||t._raf(i,e,n),r.preventDefault()}},_endEvent:function(t,e,n,i){var r=this;return function(s){n.status||t._raf(r,t._keyupWrapper(e,n),i),s.preventDefault()}},_ms:function(t){var e=this;return"function"==typeof t?function(){return t.apply(e,arguments)}:function(){return t}}},"function"==typeof define&&define.amd?define("Reanime",r):window.Reanime=r}();